<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>乒乓球</title>
    <style>
        body {
            margin: 0;
            padding: 20px;
            background: #2c3e50;
            color: white;
            font-family: Arial, sans-serif;
            display: flex;
            flex-direction: column;
            align-items: center;
        }
        
        #gameCanvas {
            border: 2px solid #ecf0f1;
            background: #1a252f;
        }
        
        .score-board {
            display: flex;
            justify-content: space-between;
            width: 600px;
            margin-bottom: 20px;
            font-size: 24px;
            font-weight: bold;
        }
        
        .controls {
            margin: 20px 0;
            text-align: center;
        }
        
        button {
            background: #3498db;
            color: white;
            border: none;
            padding: 10px 20px;
            margin: 5px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 16px;
        }
        
        button:hover {
            background: #2980b9;
        }
        
        .instructions {
            margin-top: 20px;
            text-align: center;
            color: #bdc3c7;
        }
    </style>
</head>
<body>
    <div class="score-board">
        <div>玩家1: <span id="player1Score">0</span></div>
        <div>玩家2: <span id="player2Score">0</span></div>
    </div>
    
    <canvas id="gameCanvas" width="600" height="400"></canvas>
    
    <div class="controls">
        <button onclick="startGame()">开始游戏</button>
        <button onclick="pauseGame()">暂停</button>
        <button onclick="resetGame()">重新开始</button>
    </div>
    
    <div class="instructions">
        <p><strong>控制说明:</strong></p>
        <p>玩家1: W/S 键控制左侧挡板</p>
        <p>玩家2: ↑/↓ 箭头键控制右侧挡板</p>
        <p>第一个得到10分的玩家获胜！</p>
    </div>

    <script>
        const canvas = document.getElementById('gameCanvas');
        const ctx = canvas.getContext('2d');
        const player1ScoreElement = document.getElementById('player1Score');
        const player2ScoreElement = document.getElementById('player2Score');
        
        let gameRunning = false;
        let gameLoop;
        
        // 游戏对象
        const game = {
            player1Score: 0,
            player2Score: 0,
            ball: {
                x: canvas.width / 2,
                y: canvas.height / 2,
                radius: 10,
                velocityX: 5,
                velocityY: 3,
                speed: 5
            },
            paddle1: {
                x: 10,
                y: canvas.height / 2 - 50,
                width: 10,
                height: 100,
                velocity: 0
            },
            paddle2: {
                x: canvas.width - 20,
                y: canvas.height / 2 - 50,
                width: 10,
                height: 100,
                velocity: 0
            }
        };
        
        const keys = {
            w: false,
            s: false,
            up: false,
            down: false
        };
        
        function drawRect(x, y, width, height, color) {
            ctx.fillStyle = color;
            ctx.fillRect(x, y, width, height);
        }
        
        function drawCircle(x, y, radius, color) {
            ctx.fillStyle = color;
            ctx.beginPath();
            ctx.arc(x, y, radius, 0, Math.PI * 2);
            ctx.fill();
        }
        
        function drawLine(x1, y1, x2, y2, color, width = 2) {
            ctx.strokeStyle = color;
            ctx.lineWidth = width;
            ctx.beginPath();
            ctx.moveTo(x1, y1);
            ctx.lineTo(x2, y2);
            ctx.stroke();
        }
        
        function draw() {
            // 清空画布
            drawRect(0, 0, canvas.width, canvas.height, '#1a252f');
            
            // 绘制中线
            drawLine(canvas.width / 2, 0, canvas.width / 2, canvas.height, '#ecf0f1', 3);
            
            // 绘制挡板
            drawRect(game.paddle1.x, game.paddle1.y, game.paddle1.width, game.paddle1.height, '#3498db');
            drawRect(game.paddle2.x, game.paddle2.y, game.paddle2.width, game.paddle2.height, '#e74c3c');
            
            // 绘制球
            drawCircle(game.ball.x, game.ball.y, game.ball.radius, '#f1c40f');
        }
        
        function update() {
            if (!gameRunning) return;
            
            // 更新挡板位置
            if (keys.w && game.paddle1.y > 0) {
                game.paddle1.y -= 7;
            }
            if (keys.s && game.paddle1.y < canvas.height - game.paddle1.height) {
                game.paddle1.y += 7;
            }
            if (keys.up && game.paddle2.y > 0) {
                game.paddle2.y -= 7;
            }
            if (keys.down && game.paddle2.y < canvas.height - game.paddle2.height) {
                game.paddle2.y += 7;
            }
            
            // 更新球的位置
            game.ball.x += game.ball.velocityX;
            game.ball.y += game.ball.velocityY;
            
            // 球与上下边界的碰撞
            if (game.ball.y + game.ball.radius > canvas.height || game.ball.y - game.ball.radius < 0) {
                game.ball.velocityY = -game.ball.velocityY;
            }
            
            // 球与挡板的碰撞检测
            let paddle = (game.ball.x < canvas.width / 2) ? game.paddle1 : game.paddle2;
            
            if (game.ball.x - game.ball.radius < paddle.x + paddle.width &&
                game.ball.x + game.ball.radius > paddle.x &&
                game.ball.y - game.ball.radius < paddle.y + paddle.height &&
                game.ball.y + game.ball.radius > paddle.y) {
                
                // 改变球的方向
                game.ball.velocityX = -game.ball.velocityX;
                
                // 根据击中位置改变角度
                let collidePoint = game.ball.y - (paddle.y + paddle.height / 2);
                collidePoint = collidePoint / (paddle.height / 2);
                
                let angleRad = collidePoint * Math.PI / 4;
                let direction = (game.ball.x < canvas.width / 2) ? 1 : -1;
                
                game.ball.velocityX = direction * game.ball.speed * Math.cos(angleRad);
                game.ball.velocityY = game.ball.speed * Math.sin(angleRad);
                
                // 增加球速
                game.ball.speed += 0.1;
            }
            
            // 得分检测
            if (game.ball.x < 0) {
                game.player2Score++;
                player2ScoreElement.textContent = game.player2Score;
                resetBall();
                checkWin();
            } else if (game.ball.x > canvas.width) {
                game.player1Score++;
                player1ScoreElement.textContent = game.player1Score;
                resetBall();
                checkWin();
            }
        }
        
        function resetBall() {
            game.ball.x = canvas.width / 2;
            game.ball.y = canvas.height / 2;
            game.ball.velocityX = -game.ball.velocityX;
            game.ball.velocityY = Math.random() * 4 - 2;
            game.ball.speed = 5;
        }
        
        function checkWin() {
            if (game.player1Score >= 10) {
                gameRunning = false;
                clearInterval(gameLoop);
                alert('玩家1 获胜！');
            } else if (game.player2Score >= 10) {
                gameRunning = false;
                clearInterval(gameLoop);
                alert('玩家2 获胜！');
            }
        }
        
        function gameStep() {
            update();
            draw();
        }
        
        function startGame() {
            if (gameRunning) return;
            gameRunning = true;
            gameLoop = setInterval(gameStep, 1000 / 60); // 60 FPS
        }
        
        function pauseGame() {
            gameRunning = false;
            clearInterval(gameLoop);
        }
        
        function resetGame() {
            gameRunning = false;
            clearInterval(gameLoop);
            
            game.player1Score = 0;
            game.player2Score = 0;
            player1ScoreElement.textContent = '0';
            player2ScoreElement.textContent = '0';
            
            game.ball.x = canvas.width / 2;
            game.ball.y = canvas.height / 2;
            game.ball.velocityX = 5;
            game.ball.velocityY = 3;
            game.ball.speed = 5;
            
            game.paddle1.y = canvas.height / 2 - 50;
            game.paddle2.y = canvas.height / 2 - 50;
            
            draw();
        }
        
        // 键盘事件
        document.addEventListener('keydown', (e) => {
            switch(e.key.toLowerCase()) {
                case 'w':
                    keys.w = true;
                    break;
                case 's':
                    keys.s = true;
                    break;
                case 'arrowup':
                    keys.up = true;
                    e.preventDefault();
                    break;
                case 'arrowdown':
                    keys.down = true;
                    e.preventDefault();
                    break;
            }
        });
        
        document.addEventListener('keyup', (e) => {
            switch(e.key.toLowerCase()) {
                case 'w':
                    keys.w = false;
                    break;
                case 's':
                    keys.s = false;
                    break;
                case 'arrowup':
                    keys.up = false;
                    break;
                case 'arrowdown':
                    keys.down = false;
                    break;
            }
        });
        
        // 初始化
        draw();
    </script>
</body>
</html>