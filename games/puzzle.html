<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>滑块拼图</title>
    <style>
        body {
            margin: 0;
            padding: 20px;
            background: linear-gradient(135deg, #ff6b6b 0%, #feca57 100%);
            color: white;
            font-family: Arial, sans-serif;
            display: flex;
            flex-direction: column;
            align-items: center;
            min-height: 100vh;
        }
        
        h1 {
            margin-bottom: 20px;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.3);
        }
        
        .game-info {
            display: flex;
            gap: 30px;
            margin-bottom: 20px;
            font-size: 18px;
        }
        
        .puzzle-container {
            display: grid;
            grid-template-columns: repeat(4, 80px);
            grid-template-rows: repeat(4, 80px);
            gap: 2px;
            background: #2c3e50;
            padding: 10px;
            border-radius: 10px;
            margin: 20px 0;
        }
        
        .puzzle-tile {
            width: 80px;
            height: 80px;
            background: #3498db;
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            font-weight: bold;
            cursor: pointer;
            border-radius: 5px;
            transition: all 0.2s ease;
            user-select: none;
        }
        
        .puzzle-tile:hover {
            background: #2980b9;
            transform: scale(1.05);
        }
        
        .puzzle-tile.empty {
            background: transparent;
            cursor: default;
        }
        
        .puzzle-tile.empty:hover {
            transform: none;
        }
        
        .controls {
            margin: 20px 0;
            text-align: center;
        }
        
        button {
            background: #e74c3c;
            color: white;
            border: none;
            padding: 10px 20px;
            margin: 5px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 16px;
        }
        
        button:hover {
            background: #c0392b;
        }
        
        .instructions {
            margin-top: 20px;
            text-align: center;
            color: white;
            max-width: 500px;
        }
        
        .solved {
            animation: celebration 1s ease-in-out;
        }
        
        @keyframes celebration {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.1); }
        }
    </style>
</head>
<body>
    <h1>🧩 滑块拼图</h1>
    
    <div class="game-info">
        <div>步数: <span id="moves">0</span></div>
        <div>时间: <span id="time">00:00</span></div>
        <div>状态: <span id="status">未开始</span></div>
    </div>
    
    <div class="puzzle-container" id="puzzleContainer"></div>
    
    <div class="controls">
        <button onclick="newGame()">新游戏</button>
        <button onclick="shuffle()">打乱</button>
        <button onclick="solve()">解答</button>
        <button onclick="resetGame()">重置</button>
    </div>
    
    <div class="instructions">
        <p>点击数字块移动到空位，按顺序排列所有数字</p>
        <p>目标是将数字按从1到15的顺序排列，空位在右下角</p>
    </div>

    <script>
        let gameStarted = false;
        let moves = 0;
        let startTime = 0;
        let gameTimer;
        let puzzle = [];
        let emptyPosition = { row: 3, col: 3 };
        
        const movesElement = document.getElementById('moves');
        const timeElement = document.getElementById('time');
        const statusElement = document.getElementById('status');
        const containerElement = document.getElementById('puzzleContainer');
        
        // 初始化拼图
        function initPuzzle() {
            puzzle = [];
            let number = 1;
            
            for (let row = 0; row < 4; row++) {
                puzzle[row] = [];
                for (let col = 0; col < 4; col++) {
                    if (row === 3 && col === 3) {
                        puzzle[row][col] = 0; // 空位
                    } else {
                        puzzle[row][col] = number++;
                    }
                }
            }
            
            emptyPosition = { row: 3, col: 3 };
        }
        
        // 渲染拼图
        function renderPuzzle() {
            containerElement.innerHTML = '';
            
            for (let row = 0; row < 4; row++) {
                for (let col = 0; col < 4; col++) {
                    const tile = document.createElement('div');
                    tile.className = 'puzzle-tile';
                    tile.dataset.row = row;
                    tile.dataset.col = col;
                    
                    if (puzzle[row][col] === 0) {
                        tile.classList.add('empty');
                    } else {
                        tile.textContent = puzzle[row][col];
                        tile.addEventListener('click', () => moveTile(row, col));
                    }
                    
                    containerElement.appendChild(tile);
                }
            }
        }
        
        // 移动瓦片
        function moveTile(row, col) {
            if (!gameStarted) return;
            
            // 检查是否可以移动（与空位相邻）
            const isAdjacent = (
                (Math.abs(row - emptyPosition.row) === 1 && col === emptyPosition.col) ||
                (Math.abs(col - emptyPosition.col) === 1 && row === emptyPosition.row)
            );
            
            if (!isAdjacent) return;
            
            // 交换瓦片和空位
            puzzle[emptyPosition.row][emptyPosition.col] = puzzle[row][col];
            puzzle[row][col] = 0;
            
            emptyPosition = { row, col };
            moves++;
            movesElement.textContent = moves;
            
            renderPuzzle();
            
            // 检查是否解决
            if (isSolved()) {
                gameWon();
            }
        }
        
        // 检查是否解决
        function isSolved() {
            let number = 1;
            for (let row = 0; row < 4; row++) {
                for (let col = 0; col < 4; col++) {
                    if (row === 3 && col === 3) {
                        if (puzzle[row][col] !== 0) return false;
                    } else {
                        if (puzzle[row][col] !== number++) return false;
                    }
                }
            }
            return true;
        }
        
        // 打乱拼图
        function shufflePuzzle(steps = 1000) {
            const directions = [
                { row: -1, col: 0 }, // 上
                { row: 1, col: 0 },  // 下
                { row: 0, col: -1 }, // 左
                { row: 0, col: 1 }   // 右
            ];
            
            for (let i = 0; i < steps; i++) {
                const validMoves = directions.filter(dir => {
                    const newRow = emptyPosition.row + dir.row;
                    const newCol = emptyPosition.col + dir.col;
                    return newRow >= 0 && newRow < 4 && newCol >= 0 && newCol < 4;
                });
                
                if (validMoves.length > 0) {
                    const randomMove = validMoves[Math.floor(Math.random() * validMoves.length)];
                    const newRow = emptyPosition.row + randomMove.row;
                    const newCol = emptyPosition.col + randomMove.col;
                    
                    // 交换
                    puzzle[emptyPosition.row][emptyPosition.col] = puzzle[newRow][newCol];
                    puzzle[newRow][newCol] = 0;
                    emptyPosition = { row: newRow, col: newCol };
                }
            }
        }
        
        // 更新计时器
        function updateTimer() {
            const elapsed = Math.floor((Date.now() - startTime) / 1000);
            const minutes = Math.floor(elapsed / 60).toString().padStart(2, '0');
            const seconds = (elapsed % 60).toString().padStart(2, '0');
            timeElement.textContent = `${minutes}:${seconds}`;
        }
        
        // 开始新游戏
        function newGame() {
            gameStarted = true;
            moves = 0;
            movesElement.textContent = '0';
            timeElement.textContent = '00:00';
            statusElement.textContent = '游戏中';
            
            initPuzzle();
            shufflePuzzle();
            renderPuzzle();
            
            startTime = Date.now();
            gameTimer = setInterval(updateTimer, 1000);
        }
        
        // 只打乱不重置计时
        function shuffle() {
            if (!gameStarted) {
                newGame();
                return;
            }
            
            shufflePuzzle();
            renderPuzzle();
        }
        
        // 自动解答
        function solve() {
            initPuzzle();
            renderPuzzle();
            
            if (gameStarted) {
                gameWon();
            }
        }
        
        // 重置游戏
        function resetGame() {
            gameStarted = false;
            clearInterval(gameTimer);
            
            moves = 0;
            movesElement.textContent = '0';
            timeElement.textContent = '00:00';
            statusElement.textContent = '未开始';
            
            initPuzzle();
            renderPuzzle();
        }
        
        // 获胜
        function gameWon() {
            gameStarted = false;
            clearInterval(gameTimer);
            statusElement.textContent = '游戏完成';
            
            containerElement.classList.add('solved');
            
            const elapsed = Math.floor((Date.now() - startTime) / 1000);
            const minutes = Math.floor(elapsed / 60);
            const seconds = elapsed % 60;
            
            setTimeout(() => {
                containerElement.classList.remove('solved');
                alert(`恭喜你完成了拼图！\n用时: ${minutes}分${seconds}秒\n步数: ${moves}`);
            }, 1000);
        }
        
        // 初始化
        initPuzzle();
        renderPuzzle();
    </script>
</body>
</html>