<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>吃豆豆</title>
    <style>
        body {
            margin: 0;
            padding: 20px;
            background: #000;
            color: white;
            font-family: Arial, sans-serif;
            display: flex;
            flex-direction: column;
            align-items: center;
        }
        
        #gameCanvas {
            border: 2px solid #00f;
            background: #000;
        }
        
        .game-info {
            display: flex;
            gap: 30px;
            margin-bottom: 20px;
            font-size: 18px;
        }
        
        .controls {
            margin: 20px 0;
            text-align: center;
        }
        
        button {
            background: #ff0;
            color: #000;
            border: none;
            padding: 10px 20px;
            margin: 5px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 16px;
            font-weight: bold;
        }
        
        button:hover {
            background: #dd0;
        }
        
        .instructions {
            margin-top: 20px;
            text-align: center;
            color: #ccc;
        }
    </style>
</head>
<body>
    <div class="game-info">
        <div>分数: <span id="score">0</span></div>
        <div>生命: <span id="lives">3</span></div>
        <div>等级: <span id="level">1</span></div>
    </div>
    
    <canvas id="gameCanvas" width="600" height="600"></canvas>
    
    <div class="controls">
        <button onclick="startGame()">开始游戏</button>
        <button onclick="pauseGame()">暂停</button>
        <button onclick="resetGame()">重新开始</button>
    </div>
    
    <div class="instructions">
        <p>箭头键或WASD控制吃豆人移动</p>
        <p>收集所有豆子，避开鬼魂</p>
        <p>吃大豆子可以短时间反击鬼魂！</p>
    </div>

    <script>
        const canvas = document.getElementById('gameCanvas');
        const ctx = canvas.getContext('2d');
        const scoreElement = document.getElementById('score');
        const livesElement = document.getElementById('lives');
        const levelElement = document.getElementById('level');
        
        let gameRunning = false;
        let gameLoop;
        
        const TILE_SIZE = 20;
        const ROWS = canvas.height / TILE_SIZE;
        const COLS = canvas.width / TILE_SIZE;
        
        const game = {
            score: 0,
            lives: 3,
            level: 1,
            pacman: {
                x: 15,
                y: 15,
                direction: 0,
                nextDirection: 0,
                mouthOpen: true,
                powerMode: 0
            },
            ghosts: [
                { x: 12, y: 12, direction: 0, color: '#f00', scared: false },
                { x: 15, y: 12, direction: 1, color: '#faa', scared: false },
                { x: 18, y: 12, direction: 2, color: '#0ff', scared: false },
                { x: 21, y: 12, direction: 3, color: '#ffa', scared: false }
            ],
            maze: [],
            dots: [],
            powerPellets: [],
            dotsRemaining: 0
        };
        
        function initMaze() {
            game.maze = Array(ROWS).fill().map(() => Array(COLS).fill(0));
            game.dots = [];
            game.powerPellets = [];
            
            for (let y = 5; y < ROWS - 5; y++) {
                for (let x = 5; x < COLS - 5; x++) {
                    game.maze[y][x] = 0;
                    
                    if ((x % 2 === 1 || y % 2 === 1) && 
                        !(x >= 13 && x <= 17 && y >= 11 && y <= 13)) {
                        game.dots.push({ x, y });
                    }
                }
            }
            
            for (let y = 0; y < ROWS; y++) {
                game.maze[y][0] = 1;
                game.maze[y][COLS - 1] = 1;
            }
            for (let x = 0; x < COLS; x++) {
                game.maze[0][x] = 1;
                game.maze[ROWS - 1][x] = 1;
            }
            
            for (let y = 8; y < 12; y++) {
                for (let x = 8; x < 12; x++) {
                    game.maze[y][x] = 1;
                }
            }
            for (let y = 8; y < 12; y++) {
                for (let x = 18; x < 22; x++) {
                    game.maze[y][x] = 1;
                }
            }
            for (let y = 18; y < 22; y++) {
                for (let x = 8; x < 12; x++) {
                    game.maze[y][x] = 1;
                }
            }
            for (let y = 18; y < 22; y++) {
                for (let x = 18; x < 22; x++) {
                    game.maze[y][x] = 1;
                }
            }
            
            game.powerPellets = [
                { x: 7, y: 7 },
                { x: 22, y: 7 },
                { x: 7, y: 22 },
                { x: 22, y: 22 }
            ];
            
            game.dotsRemaining = game.dots.length;
        }
        
        function canMoveTo(x, y) {
            return x >= 0 && x < COLS && y >= 0 && y < ROWS && game.maze[y][x] === 0;
        }
        
        function drawWall(x, y) {
            ctx.fillStyle = '#00f';
            ctx.fillRect(x * TILE_SIZE, y * TILE_SIZE, TILE_SIZE, TILE_SIZE);
        }
        
        function drawDot(x, y) {
            ctx.fillStyle = '#ff0';
            ctx.beginPath();
            ctx.arc(
                x * TILE_SIZE + TILE_SIZE / 2,
                y * TILE_SIZE + TILE_SIZE / 2,
                2, 0, Math.PI * 2
            );
            ctx.fill();
        }
        
        function drawPowerPellet(x, y) {
            ctx.fillStyle = '#ff0';
            ctx.beginPath();
            ctx.arc(
                x * TILE_SIZE + TILE_SIZE / 2,
                y * TILE_SIZE + TILE_SIZE / 2,
                6, 0, Math.PI * 2
            );
            ctx.fill();
        }
        
        function drawPacman() {
            const centerX = game.pacman.x * TILE_SIZE + TILE_SIZE / 2;
            const centerY = game.pacman.y * TILE_SIZE + TILE_SIZE / 2;
            const radius = TILE_SIZE / 2 - 2;
            
            ctx.fillStyle = '#ff0';
            ctx.beginPath();
            
            if (game.pacman.mouthOpen) {
                const mouthAngle = Math.PI / 3;
                const startAngle = game.pacman.direction * Math.PI / 2 - mouthAngle / 2;
                const endAngle = game.pacman.direction * Math.PI / 2 + mouthAngle / 2;
                
                ctx.arc(centerX, centerY, radius, startAngle, endAngle);
                ctx.lineTo(centerX, centerY);
            } else {
                ctx.arc(centerX, centerY, radius, 0, Math.PI * 2);
            }
            
            ctx.fill();
        }
        
        function drawGhost(ghost) {
            const centerX = ghost.x * TILE_SIZE + TILE_SIZE / 2;
            const centerY = ghost.y * TILE_SIZE + TILE_SIZE / 2;
            const radius = TILE_SIZE / 2 - 2;
            
            ctx.fillStyle = ghost.scared ? '#00f' : ghost.color;
            
            ctx.beginPath();
            ctx.arc(centerX, centerY - radius / 2, radius, Math.PI, 0);
            ctx.lineTo(centerX + radius, centerY + radius / 2);
            ctx.lineTo(centerX + radius / 2, centerY + radius);
            ctx.lineTo(centerX, centerY + radius / 2);
            ctx.lineTo(centerX - radius / 2, centerY + radius);
            ctx.lineTo(centerX - radius, centerY + radius / 2);
            ctx.closePath();
            ctx.fill();
            
            ctx.fillStyle = '#fff';
            ctx.fillRect(centerX - 6, centerY - 6, 4, 4);
            ctx.fillRect(centerX + 2, centerY - 6, 4, 4);
            
            ctx.fillStyle = '#000';
            ctx.fillRect(centerX - 5, centerY - 5, 2, 2);
            ctx.fillRect(centerX + 3, centerY - 5, 2, 2);
        }
        
        function draw() {
            ctx.fillStyle = '#000';
            ctx.fillRect(0, 0, canvas.width, canvas.height);
            
            for (let y = 0; y < ROWS; y++) {
                for (let x = 0; x < COLS; x++) {
                    if (game.maze[y][x] === 1) {
                        drawWall(x, y);
                    }
                }
            }
            
            game.dots.forEach(dot => drawDot(dot.x, dot.y));
            game.powerPellets.forEach(pellet => drawPowerPellet(pellet.x, pellet.y));
            drawPacman();
            game.ghosts.forEach(drawGhost);
        }
        
        function update() {
            if (!gameRunning) return;
            
            game.pacman.mouthOpen = !game.pacman.mouthOpen;
            
            const directions = [
                { dx: 1, dy: 0 },
                { dx: 0, dy: 1 },
                { dx: -1, dy: 0 },
                { dx: 0, dy: -1 }
            ];
            
            const nextDir = directions[game.pacman.nextDirection];
            const nextX = game.pacman.x + nextDir.dx;
            const nextY = game.pacman.y + nextDir.dy;
            
            if (canMoveTo(nextX, nextY)) {
                game.pacman.direction = game.pacman.nextDirection;
            }
            
            const currentDir = directions[game.pacman.direction];
            const newX = game.pacman.x + currentDir.dx;
            const newY = game.pacman.y + currentDir.dy;
            
            if (canMoveTo(newX, newY)) {
                game.pacman.x = newX;
                game.pacman.y = newY;
            }
            
            for (let i = game.dots.length - 1; i >= 0; i--) {
                const dot = game.dots[i];
                if (dot.x === game.pacman.x && dot.y === game.pacman.y) {
                    game.dots.splice(i, 1);
                    game.score += 10;
                    scoreElement.textContent = game.score;
                    game.dotsRemaining--;
                }
            }
            
            for (let i = game.powerPellets.length - 1; i >= 0; i--) {
                const pellet = game.powerPellets[i];
                if (pellet.x === game.pacman.x && pellet.y === game.pacman.y) {
                    game.powerPellets.splice(i, 1);
                    game.score += 50;
                    scoreElement.textContent = game.score;
                    game.pacman.powerMode = 100;
                    
                    game.ghosts.forEach(ghost => {
                        ghost.scared = true;
                    });
                }
            }
            
            if (game.pacman.powerMode > 0) {
                game.pacman.powerMode--;
                if (game.pacman.powerMode === 0) {
                    game.ghosts.forEach(ghost => {
                        ghost.scared = false;
                    });
                }
            }
            
            game.ghosts.forEach(ghost => {
                if (Math.random() < 0.3) {
                    ghost.direction = Math.floor(Math.random() * 4);
                }
                
                const ghostDir = directions[ghost.direction];
                const ghostNewX = ghost.x + ghostDir.dx;
                const ghostNewY = ghost.y + ghostDir.dy;
                
                if (canMoveTo(ghostNewX, ghostNewY)) {
                    ghost.x = ghostNewX;
                    ghost.y = ghostNewY;
                } else {
                    ghost.direction = Math.floor(Math.random() * 4);
                }
            });
            
            game.ghosts.forEach((ghost, index) => {
                if (ghost.x === game.pacman.x && ghost.y === game.pacman.y) {
                    if (ghost.scared) {
                        game.score += 200;
                        scoreElement.textContent = game.score;
                        
                        ghost.x = 12 + index;
                        ghost.y = 12;
                        ghost.scared = false;
                    } else {
                        game.lives--;
                        livesElement.textContent = game.lives;
                        
                        if (game.lives <= 0) {
                            gameOver();
                            return;
                        }
                        
                        game.pacman.x = 15;
                        game.pacman.y = 15;
                        game.pacman.direction = 0;
                        game.pacman.powerMode = 0;
                        
                        game.ghosts.forEach((g, i) => {
                            g.x = 12 + i;
                            g.y = 12;
                            g.scared = false;
                        });
                    }
                }
            });
            
            if (game.dotsRemaining === 0) {
                nextLevel();
            }
        }
        
        function nextLevel() {
            game.level++;
            levelElement.textContent = game.level;
            initMaze();
            
            game.pacman.x = 15;
            game.pacman.y = 15;
            game.pacman.direction = 0;
            game.pacman.powerMode = 0;
            
            game.ghosts.forEach((ghost, i) => {
                ghost.x = 12 + i;
                ghost.y = 12;
                ghost.scared = false;
            });
        }
        
        function gameOver() {
            gameRunning = false;
            clearInterval(gameLoop);
            alert(`游戏结束！最终分数: ${game.score}`);
        }
        
        function gameStep() {
            update();
            draw();
        }
        
        function startGame() {
            if (gameRunning) return;
            gameRunning = true;
            gameLoop = setInterval(gameStep, 200);
        }
        
        function pauseGame() {
            gameRunning = false;
            clearInterval(gameLoop);
        }
        
        function resetGame() {
            gameRunning = false;
            clearInterval(gameLoop);
            
            game.score = 0;
            game.lives = 3;
            game.level = 1;
            
            scoreElement.textContent = '0';
            livesElement.textContent = '3';
            levelElement.textContent = '1';
            
            game.pacman.x = 15;
            game.pacman.y = 15;
            game.pacman.direction = 0;
            game.pacman.nextDirection = 0;
            game.pacman.powerMode = 0;
            
            game.ghosts.forEach((ghost, i) => {
                ghost.x = 12 + i;
                ghost.y = 12;
                ghost.scared = false;
            });
            
            initMaze();
            draw();
        }
        
        document.addEventListener('keydown', (e) => {
            switch(e.key) {
                case 'ArrowLeft':
                case 'a':
                case 'A':
                    game.pacman.nextDirection = 2;
                    break;
                case 'ArrowRight':
                case 'd':
                case 'D':
                    game.pacman.nextDirection = 0;
                    break;
                case 'ArrowUp':
                case 'w':
                case 'W':
                    game.pacman.nextDirection = 3;
                    break;
                case 'ArrowDown':
                case 's':
                case 'S':
                    game.pacman.nextDirection = 1;
                    break;
            }
        });
        
        initMaze();
        draw();
    </script>
</body>
</html>