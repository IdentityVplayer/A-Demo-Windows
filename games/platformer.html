<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>步行者</title>
    <style>
        body {
            margin: 0;
            padding: 20px;
            background: linear-gradient(to bottom, #87CEEB 0%, #98FB98 50%, #8B4513 100%);
            color: white;
            font-family: Arial, sans-serif;
            display: flex;
            flex-direction: column;
            align-items: center;
            overflow: hidden;
        }
        
        h1 {
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.5);
        }
        
        #gameCanvas {
            border: 3px solid #654321;
            background: linear-gradient(to bottom, #87CEEB 0%, #90EE90 100%);
            box-shadow: 0 0 20px rgba(0, 0, 0, 0.3);
        }
        
        .game-info {
            display: flex;
            gap: 30px;
            margin-bottom: 10px;
            font-size: 18px;
            background: rgba(0, 0, 0, 0.5);
            padding: 10px 20px;
            border-radius: 20px;
        }
        
        .controls {
            margin-top: 10px;
            text-align: center;
        }
        
        button {
            background: #8B4513;
            color: white;
            border: none;
            padding: 8px 16px;
            margin: 3px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 14px;
        }
        
        button:hover {
            background: #654321;
        }
        
        .instructions {
            margin-top: 10px;
            text-align: center;
            color: #2c3e50;
            background: rgba(255, 255, 255, 0.8);
            padding: 10px;
            border-radius: 10px;
            font-size: 14px;
        }
    </style>
</head>
<body>
    <h1>🚶‍♂️ 步行者</h1>
    
    <div class="game-info">
        <div>分数: <span id="score">0</span></div>
        <div>生命: <span id="lives">3</span></div>
        <div>等级: <span id="level">1</span></div>
    </div>
    
    <canvas id="gameCanvas" width="400" height="300"></canvas>
    
    <div class="controls">
        <button onclick="startGame()">开始游戏</button>
        <button onclick="pauseGame()">暂停</button>
        <button onclick="resetGame()">重置</button>
    </div>
    
    <div class="instructions">
        <p>箭头键或WASD控制角色移动，收集金币并避开障碍物</p>
    </div>

    <script>
        const canvas = document.getElementById('gameCanvas');
        const ctx = canvas.getContext('2d');
        const scoreElement = document.getElementById('score');
        const livesElement = document.getElementById('lives');
        const levelElement = document.getElementById('level');
        
        let gameRunning = false;
        let gameLoop;
        
        const game = {
            score: 0,
            lives: 3,
            level: 1,
            player: {
                x: 50,
                y: 250,
                width: 20,
                height: 20,
                speed: 3,
                color: '#ff6b6b'
            },
            coins: [],
            obstacles: [],
            platforms: [
                { x: 0, y: 280, width: canvas.width, height: 20 },
                { x: 100, y: 220, width: 80, height: 10 },
                { x: 220, y: 160, width: 80, height: 10 },
                { x: 320, y: 100, width: 80, height: 10 }
            ],
            keys: {
                left: false,
                right: false,
                up: false,
                down: false
            },
            gravity: 0.5,
            jumpPower: -12,
            playerVelocityY: 0,
            onGround: false
        };
        
        function initLevel() {
            game.coins = [];
            game.obstacles = [];
            
            // 生成金币
            for (let i = 0; i < 5 + game.level; i++) {
                game.coins.push({
                    x: Math.random() * (canvas.width - 20) + 10,
                    y: Math.random() * (canvas.height - 100) + 20,
                    width: 15,
                    height: 15,
                    collected: false
                });
            }
            
            // 生成障碍物
            for (let i = 0; i < 2 + Math.floor(game.level / 2); i++) {
                game.obstacles.push({
                    x: Math.random() * (canvas.width - 30) + 15,
                    y: Math.random() * (canvas.height - 120) + 20,
                    width: 20,
                    height: 20,
                    speed: 1 + Math.random() * 2,
                    direction: Math.random() > 0.5 ? 1 : -1
                });
            }
        }
        
        function draw() {
            // 清空画布
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            
            // 绘制背景
            const gradient = ctx.createLinearGradient(0, 0, 0, canvas.height);
            gradient.addColorStop(0, '#87CEEB');
            gradient.addColorStop(0.7, '#90EE90');
            gradient.addColorStop(1, '#8B4513');
            ctx.fillStyle = gradient;
            ctx.fillRect(0, 0, canvas.width, canvas.height);
            
            // 绘制平台
            ctx.fillStyle = '#654321';
            game.platforms.forEach(platform => {
                ctx.fillRect(platform.x, platform.y, platform.width, platform.height);
            });
            
            // 绘制金币
            game.coins.forEach(coin => {
                if (!coin.collected) {
                    ctx.fillStyle = '#ffd700';
                    ctx.beginPath();
                    ctx.arc(coin.x + coin.width/2, coin.y + coin.height/2, coin.width/2, 0, Math.PI * 2);
                    ctx.fill();
                    
                    // 金币闪烁效果
                    ctx.strokeStyle = '#ffed4e';
                    ctx.lineWidth = 2;
                    ctx.stroke();
                }
            });
            
            // 绘制障碍物
            game.obstacles.forEach(obstacle => {
                ctx.fillStyle = '#e74c3c';
                ctx.fillRect(obstacle.x, obstacle.y, obstacle.width, obstacle.height);
                
                // 添加危险标志
                ctx.fillStyle = '#fff';
                ctx.font = '12px Arial';
                ctx.textAlign = 'center';
                ctx.fillText('!', obstacle.x + obstacle.width/2, obstacle.y + obstacle.height/2 + 4);
            });
            
            // 绘制玩家
            ctx.fillStyle = game.player.color;
            ctx.fillRect(game.player.x, game.player.y, game.player.width, game.player.height);
            
            // 添加玩家眼睛
            ctx.fillStyle = '#fff';
            ctx.fillRect(game.player.x + 3, game.player.y + 3, 4, 4);
            ctx.fillRect(game.player.x + 13, game.player.y + 3, 4, 4);
            
            ctx.fillStyle = '#000';
            ctx.fillRect(game.player.x + 4, game.player.y + 4, 2, 2);
            ctx.fillRect(game.player.x + 14, game.player.y + 4, 2, 2);
        }
        
        function update() {
            if (!gameRunning) return;
            
            // 更新玩家水平移动
            if (game.keys.left && game.player.x > 0) {
                game.player.x -= game.player.speed;
            }
            if (game.keys.right && game.player.x < canvas.width - game.player.width) {
                game.player.x += game.player.speed;
            }
            
            // 跳跃
            if (game.keys.up && game.onGround) {
                game.playerVelocityY = game.jumpPower;
                game.onGround = false;
            }
            
            // 重力
            game.playerVelocityY += game.gravity;
            game.player.y += game.playerVelocityY;
            
            // 检查平台碰撞
            game.onGround = false;
            game.platforms.forEach(platform => {
                if (game.player.x < platform.x + platform.width &&
                    game.player.x + game.player.width > platform.x &&
                    game.player.y < platform.y + platform.height &&
                    game.player.y + game.player.height > platform.y) {
                    
                    if (game.playerVelocityY > 0) { // 下落时才着陆
                        game.player.y = platform.y - game.player.height;
                        game.playerVelocityY = 0;
                        game.onGround = true;
                    }
                }
            });
            
            // 防止玩家掉出屏幕
            if (game.player.y > canvas.height) {
                game.lives--;
                livesElement.textContent = game.lives;
                resetPlayerPosition();
                
                if (game.lives <= 0) {
                    gameOver();
                    return;
                }
            }
            
            // 更新障碍物
            game.obstacles.forEach(obstacle => {
                obstacle.x += obstacle.speed * obstacle.direction;
                
                if (obstacle.x <= 0 || obstacle.x >= canvas.width - obstacle.width) {
                    obstacle.direction *= -1;
                }
            });
            
            // 检查金币收集
            game.coins.forEach(coin => {
                if (!coin.collected &&
                    game.player.x < coin.x + coin.width &&
                    game.player.x + game.player.width > coin.x &&
                    game.player.y < coin.y + coin.height &&
                    game.player.y + game.player.height > coin.y) {
                    
                    coin.collected = true;
                    game.score += 10;
                    scoreElement.textContent = game.score;
                }
            });
            
            // 检查障碍物碰撞
            game.obstacles.forEach(obstacle => {
                if (game.player.x < obstacle.x + obstacle.width &&
                    game.player.x + game.player.width > obstacle.x &&
                    game.player.y < obstacle.y + obstacle.height &&
                    game.player.y + game.player.height > obstacle.y) {
                    
                    game.lives--;
                    livesElement.textContent = game.lives;
                    resetPlayerPosition();
                    
                    if (game.lives <= 0) {
                        gameOver();
                        return;
                    }
                }
            });
            
            // 检查是否收集完所有金币
            if (game.coins.every(coin => coin.collected)) {
                nextLevel();
            }
        }
        
        function resetPlayerPosition() {
            game.player.x = 50;
            game.player.y = 250;
            game.playerVelocityY = 0;
        }
        
        function nextLevel() {
            game.level++;
            levelElement.textContent = game.level;
            game.score += 50; // 奖励分
            scoreElement.textContent = game.score;
            
            resetPlayerPosition();
            initLevel();
            
            alert(`恭喜进入第${game.level}关！`);
        }
        
        function gameOver() {
            gameRunning = false;
            clearInterval(gameLoop);
            alert(`游戏结束！最终得分: ${game.score}，达到第${game.level}关`);
        }
        
        function gameStep() {
            update();
            draw();
        }
        
        function startGame() {
            if (gameRunning) return;
            gameRunning = true;
            gameLoop = setInterval(gameStep, 1000 / 60);
        }
        
        function pauseGame() {
            gameRunning = false;
            clearInterval(gameLoop);
        }
        
        function resetGame() {
            gameRunning = false;
            clearInterval(gameLoop);
            
            game.score = 0;
            game.lives = 3;
            game.level = 1;
            
            scoreElement.textContent = '0';
            livesElement.textContent = '3';
            levelElement.textContent = '1';
            
            resetPlayerPosition();
            initLevel();
            draw();
        }
        
        // 键盘事件
        document.addEventListener('keydown', (e) => {
            switch(e.key) {
                case 'ArrowLeft':
                case 'a':
                case 'A':
                    game.keys.left = true;
                    break;
                case 'ArrowRight':
                case 'd':
                case 'D':
                    game.keys.right = true;
                    break;
                case 'ArrowUp':
                case 'w':
                case 'W':
                case ' ':
                    e.preventDefault();
                    game.keys.up = true;
                    break;
            }
        });
        
        document.addEventListener('keyup', (e) => {
            switch(e.key) {
                case 'ArrowLeft':
                case 'a':
                case 'A':
                    game.keys.left = false;
                    break;
                case 'ArrowRight':
                case 'd':
                case 'D':
                    game.keys.right = false;
                    break;
                case 'ArrowUp':
                case 'w':
                case 'W':
                case ' ':
                    game.keys.up = false;
                    break;
            }
        });
        
        // 初始化
        initLevel();
        draw();
    </script>
</body>
</html>