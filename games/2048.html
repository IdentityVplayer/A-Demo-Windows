<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <title>2048</title>
    <style>
        body { background: #faf8ef; margin: 0; }
        .container { width: 340px; margin: 40px auto; background: #bbada0; border-radius: 8px; padding: 16px; }
        .board { display: grid; grid-template-columns: repeat(4, 70px); grid-gap: 10px; }
        .cell { width: 70px; height: 70px; background: #cdc1b4; border-radius: 4px; font-size: 2em; color: #776e65; display: flex; align-items: center; justify-content: center; font-weight: bold; }
        .score { text-align: center; color: #333; font-size: 1.2em; margin-bottom: 10px; }
    </style>
</head>
<body>
    <div class="container">
        <div class="score" id="score">得分: 0</div>
        <div class="board" id="board"></div>
    </div>
    <script>
    const boardDiv = document.getElementById('board');
    const scoreDiv = document.getElementById('score');
    let board = Array(4).fill().map(()=>Array(4).fill(0));
    let score = 0;
    function addRandom() {
        let empty = [];
        for(let i=0;i<4;i++) for(let j=0;j<4;j++) if(board[i][j]===0) empty.push([i,j]);
        if(empty.length) {
            let [i,j] = empty[Math.floor(Math.random()*empty.length)];
            board[i][j] = Math.random()<0.9?2:4;
        }
    }
    function draw() {
        boardDiv.innerHTML = '';
        for(let i=0;i<4;i++) for(let j=0;j<4;j++) {
            let cell = document.createElement('div');
            cell.className = 'cell';
            cell.textContent = board[i][j]||'';
            boardDiv.appendChild(cell);
        }
        scoreDiv.textContent = '得分: ' + score;
    }
    function move(dir) {
        let moved = false;
        let merged = Array(4).fill().map(()=>Array(4).fill(false));
        let traverse = (cb) => { for(let i=0;i<4;i++) for(let j=0;j<4;j++) cb(i,j); };
        let order = [0,1,2,3];
        if(dir==='down'||dir==='right') order = order.reverse();
        if(dir==='left'||dir==='right') {
            for(let i=0;i<4;i++) {
                for(let j of order) {
                    if(board[i][j]===0) continue;
                    let k = j;
                    while((dir==='left'?k>0:k<3)&&board[i][k+(dir==='left'?-1:1)]===0) {
                        board[i][k+(dir==='left'?-1:1)] = board[i][k];
                        board[i][k] = 0; k += (dir==='left'?-1:1); moved=true;
                    }
                    if((dir==='left'?k>0:k<3)&&board[i][k+(dir==='left'?-1:1)]===board[i][k]&&!merged[i][k+(dir==='left'?-1:1)]) {
                        board[i][k+(dir==='left'?-1:1)]*=2; score+=board[i][k+(dir==='left'?-1:1)]; board[i][k]=0; merged[i][k+(dir==='left'?-1:1)]=true; moved=true;
                    }
                }
            }
        } else {
            for(let j=0;j<4;j++) {
                for(let i of order) {
                    if(board[i][j]===0) continue;
                    let k = i;
                    while((dir==='up'?k>0:k<3)&&board[k+(dir==='up'?-1:1)][j]===0) {
                        board[k+(dir==='up'?-1:1)][j]=board[k][j]; board[k][j]=0; k+=(dir==='up'?-1:1); moved=true;
                    }
                    if((dir==='up'?k>0:k<3)&&board[k+(dir==='up'?-1:1)][j]===board[k][j]&&!merged[k+(dir==='up'?-1:1)][j]) {
                        board[k+(dir==='up'?-1:1)][j]*=2; score+=board[k+(dir==='up'?-1:1)][j]; board[k][j]=0; merged[k+(dir==='up'?-1:1)][j]=true; moved=true;
                    }
                }
            }
        }
        if(moved) { addRandom(); draw(); }
    }
    document.addEventListener('keydown', e => {
        if(['ArrowUp','ArrowDown','ArrowLeft','ArrowRight'].includes(e.key)) move(e.key.replace('Arrow','').toLowerCase());
    });
    addRandom(); addRandom(); draw();
    </script>
</body>
</html>
